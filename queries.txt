/* Query 1 - query used for first insight */
SELECT a.ArtistId,
       a.Name,
       count(t.Name) Songs
FROM Artist a
JOIN Album b ON a.ArtistId = b.ArtistId
JOIN Track t ON b.AlbumId = t.AlbumId
JOIN Genre g ON t.GenreId = g.GenreId
WHERE g.Name = "Rock"
GROUP BY a.Name
ORDER BY Songs DESC
LIMIT 10

/* Query 2 - query used for second insight */
SELECT a.Name Name,
       count(i.InvoiceId) puchases
FROM Artist a
JOIN Album b ON a.ArtistId = b.ArtistId
JOIN Track t ON b.AlbumId = t.AlbumId
JOIN InvoiceLine i ON i.TrackId = t.TrackId
GROUP BY a.Name
ORDER BY puchases DESC
LIMIT 5

/* Query 3 - query used for third insight */
SELECT a.Name Name,
       sum(i.UnitPrice)AmountSpent,
       c.CustomerId,
       c.FirstName|| " " || c.LastName Customer_Name
FROM Artist a
JOIN Album b ON a.ArtistId = b.ArtistId
JOIN Track t ON b.AlbumId = t.AlbumId
JOIN InvoiceLine i ON i.TrackId = t.TrackId
JOIN Invoice n ON n.InvoiceId = i.InvoiceId
JOIN Customer c ON c.CustomerId = n.CustomerId
WHERE a.Name = "Iron Maiden"
GROUP BY c.FirstName
ORDER BY AmountSpent DESC
LIMIT 5

/* Query 4 - query used for fourth insight */
WITH popular AS
  (SELECT count(n.BillingCountry) Purchases,
          n.BillingCountry Country,
          g.Name Name,
          g.GenreId GenreId
   FROM Genre g
   JOIN Track t ON g.GenreId = t.GenreId
   JOIN InvoiceLine i ON t.TrackId = i.TrackId
   JOIN Invoice n ON n.InvoiceId = i.InvoiceId
   GROUP BY n.BillingCountry,
            g.Name
   ORDER BY BillingCountry,
            Name)
SELECT p.Purchases,
       p.Country|| ' - ' || p.Name AS Country_GenreName,
       p.GenreId
FROM popular p
WHERE p.Purchases =
    (SELECT max(Purchases)
     FROM popular
     WHERE p.Country = Country
     GROUP BY Country)
ORDER BY p.Country
